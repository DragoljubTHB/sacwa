<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	template="/WEB-INF/templates/template-base.xhtml">
	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Startseite" url="index.xhtml" />
				<p:menuitem value="Schlüsselkompetenzen"
					url="all_schluesselKomp.xhtml" />
				<p:menuitem value="Kompetenzbereiche" url="all_kompBereich.xhtml" />
			</p:breadCrumb>

			<h:outputText value="Wählen Sie:" />
			<p:selectOneButton value="#{kompBereichListCtrl.showAll}">
				<f:selectItem itemLabel="Alle Kompetenzbereiche" itemValue="true" />
				<f:selectItem itemLabel="Nur zur Schluesselkompetenz"
					itemValue="false" />
			</p:selectOneButton>

			<p:commandButton value="Anwenden" update="_kbs" icon="ui-icon-check"
				actionListener="#{kompBereichListCtrl.refreshList()}" />

			<p:dataGrid id="_kbs" var="_kb"
				value="#{kompBereichListCtrl.kompetenzBereichDisplays}" columns="4"
				layout="grid" rows="12" paginator="true"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="8,16,36">

				<f:facet name="header">
            		Kompetenzbereiche
        		</f:facet>
				<p:panel style="text-align:center">
					<f:facet name="header">
						<h:commandLink id="ajax" update=":new_form:messages"
							actionListener="#{navigationSessionCtrl.setLastSelectedKompBereich(_kb.kompBereich)}"
							action="#{kompBereichListCtrl.goToKompetenz()}">
							<h:outputText value="#{_kb.kompBereich.name}" />
						</h:commandLink>
					</f:facet>

					<h:panelGrid columns="3" style="width:100%">

						<p:commandButton rendered="#{not empty _kb.kompBereich.kommentar}"
							icon="ui-icon-search" update=":form:_kbDetail"
							oncomplete="PF('_kbDialog').show()" title="Details anzeigen">
							<f:setPropertyActionListener value="#{_kb.kompBereich}"
								target="#{kompBereichCtrl.kompBereich}" />
						</p:commandButton>

						<p:commandButton icon="ui-icon-pencil" update=":form:_kbs"
							action="#{kompBereichListCtrl.goToEdit}" title="Bearbeiten">
							<f:setPropertyActionListener value="#{_kb.kompBereich}"
								target="#{kompBereichCtrl.kompBereich}" />
						</p:commandButton>


						<p:commandButton rendered="#{empty _kb.kompBereich.kompetenzen}"
							icon="ui-icon-trash" update=":form:_kbs"
							action="#{kompBereichListCtrl.delete(_kb)}"
							title="#{i18n['crud.delete']}">
							<p:confirm header="Element löschen"
								message="Soll der Kompetenbereich #{_kb.kompBereich.name} wirklich gelöscht werden?"
								icon="ui-icon-trash" />
						</p:commandButton>

						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							<p:commandButton value="No" type="button"
								styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							<p:commandButton value="Yes" type="button" update=":form:_kbs"
								styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
								action="#{kompBereichListCtrl.deleteWithK(_kb)}" />
						</p:confirmDialog>

					</h:panelGrid>
				</p:panel>

			</p:dataGrid>



			<p:commandButton value="#{i18n['crud.update']}"
				action="#{kompBereichListCtrl.refreshList}"
				update=":new_form:messages :form:_kbs" type="submit">
			</p:commandButton>

			<p />


			<p:dialog header="Kommentar" widgetVar="_kbDialog" modal="true"
				showEffect="fade" hideEffect="fade" resizable="false">
				<p:outputPanel id="_kbDetail" style="text-align:center;">
					<h:outputText value="#{kompBereichCtrl.kompBereich.kommentar}" />

				</p:outputPanel>
			</p:dialog>
		</h:form>
		<h:form id="new_form">

			<h1>Neuen Kompetenzbereich anlegen</h1>
			<p:messages id="messages" showDetail="true" closable="true" />
			<p:panel id="new_kb" title="Neue Schlüsselkompetenz anlegen">

				<h:panelGrid id="panelG" columns="2" cellpadding="5"
					styleClass="ui-grid">
					<h:outputLabel for="name" value="#{i18n['entity.name']}: " />
					<p:inputText id="name" value="#{kompBereichCtrl.kompBereich.name}"
						pt:placeholder="#{i18n['entity.name']}" />

					<h:outputLabel for="kommentar" value="Kommentar:  " />
					<p:inputTextarea id="kommentar" rows="4" cols="42"
						value="#{kompBereichCtrl.kompBereich.kommentar}"
						pt:placeholder="Kommentar" />
				</h:panelGrid>
				<p:panelGrid id="forautowidth" columns="1">
					<p:dataTable id="chec_kboxDT" rendered="#{not empty kompBereiche}"
						var="_k" value="#{kompBereichListProducer.kompBereiche}"
						selection="#{kompBereichCtrl.selectedKompetenzen}"
						rowKey="#{_k.id}" tableStyle="width:auto" reflow="true" rows="5"
						paginator="true">
						<f:facet name="header">           Kompetenzen       </f:facet>
						<p:column selectionMode="multiple"
							style="width:16px;text-align:center" />
						<p:column headerText="Name">
							<h:outputText value="#{_k.name}" />
						</p:column>
						<p:column headerText="Kommentar">
							<h:outputText value="#{_k.kommentar}" />
						</p:column>
					</p:dataTable>

				</p:panelGrid>
				<p:commandButton value="#{i18n['crud.break']}"
					action="#{kompBereichCtrl.clean()}" type="submit"
					update=":new_form:new_kb" />
				<p:commandButton value="#{i18n['crud.create']}"
					action="#{kompBereichCtrl.create()}"
					update=":new_form:messages :form:_kbs  :new_form:new_kb"
					type="submit" />
			</p:panel>

		</h:form>
	</ui:define>
</ui:composition>